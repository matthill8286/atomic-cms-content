{"version":3,"sources":["../../src/components/StaticInstanceParent.tsx"],"names":["React","useEffect","useState","useParams","useHistory","matchPath","useLocation","useStaticInstanceConnectionQuery","useSelector","ErrorPage","ErrorPageType","useRenderMeasure","useDidMount","reactiveFooter","logoVar","getRoutesPaths","SET_HEADER_ID","useAppWrapperDispatch","StaticSlicesRoutes","LandingPageWrapper","useHost","isStaticRoute","GenericLoadingScreen","getStateUser","StaticInstanceParent","route","props","name","staticInstance","setStaticInstance","paths","didMount","user","params","contextDispatch","history","location","environmentHost","landingPages","skip","variables","first","where","host","context","clientName","data","staticLoading","loading","staticError","error","staticHomeRoute","pathname","HOME","path","isExact","loggedIn","push","Dashboard","instance","slice","edges","node","type","headerId","header","id","footer","logo","url","TECHNICAL_ERROR","pageSlices","staticPages","paramsWithoutSearch","details","toString","replace","window","search","matchByType","matchByParams","routeContext","reducePageSlicesToMatchRoute","filter","pageEntryId","entryId","NOT_FOUND"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  useParams,\n  useHistory,\n  matchPath,\n  useLocation,\n} from 'react-router-dom';\nimport {\n  StaticInstanceConnectionQuery,\n  useStaticInstanceConnectionQuery,\n  Host,\n  StaticPage,\n  Maybe,\n} from '@lxp/webmobile-cms-graphql';\nimport { useSelector } from 'react-redux';\nimport { ErrorPage, ErrorPageType } from '@/components/Error';\nimport { useRenderMeasure, useDidMount } from '@/hooks';\nimport { reactiveFooter, logoVar } from '@/cache/cache';\nimport { getRoutesPaths } from '@/routes/routes.paths';\nimport {\n  SET_HEADER_ID,\n  useAppWrapperDispatch,\n} from '@/components/AppWrapper/AppWrapper.context';\nimport { StaticSlicesRoutes } from '#/src/staticPages/routes/staticSlicesRoutes';\nimport { LandingPageWrapper } from './LandingPageWrapper';\nimport { useHost } from '@/helpers/getHostInstance';\nimport { isStaticRoute } from '@/routes/helpers';\nimport { GenericLoadingScreen } from '@/components/GenericLoadingScreen';\nimport { getStateUser } from '@/store/User/user.selectors';\n\nexport const StaticInstanceParent = ({ route, ...props }) => {\n  useRenderMeasure(route.name);\n\n  const [staticInstance, setStaticInstance] =\n    useState<StaticInstanceConnectionQuery | null>(null);\n  const paths = getRoutesPaths();\n  const didMount = useDidMount();\n  const { user } = useSelector(getStateUser);\n  const params = useParams<{ details?: string }>();\n  const contextDispatch = useAppWrapperDispatch();\n\n  const history = useHistory();\n  const location = useLocation();\n  const environmentHost = useHost();\n\n  const landingPages = isStaticRoute(location);\n\n  const {\n    data,\n    loading: staticLoading,\n    error: staticError,\n  } = useStaticInstanceConnectionQuery({\n    skip: !environmentHost || !landingPages,\n    variables: {\n      first: 1,\n      where: {\n        host: environmentHost as Host,\n      },\n    },\n    context: {\n      clientName: 'graphcms',\n    },\n  });\n\n  const staticHomeRoute = matchPath(\n    location.pathname,\n    StaticSlicesRoutes.HOME.path\n  )?.isExact;\n\n  useEffect(() => {\n    if (user?.loggedIn && staticHomeRoute) {\n      history.push({\n        pathname: paths.Dashboard,\n      });\n    }\n  }, [user?.loggedIn]);\n\n  useEffect(() => {\n    if (data?.instance && !staticLoading) {\n      setStaticInstance(data);\n    }\n  }, [data?.instance, staticLoading]);\n\n  const slice = staticInstance?.instance?.edges?.[0]?.node;\n\n  useEffect(() => {\n    // @ts-ignore\n    contextDispatch({\n      type: SET_HEADER_ID,\n      headerId: slice?.header?.id,\n    });\n  }, [slice?.header?.id]);\n\n  useEffect(() => {\n    if (didMount && slice?.footer && slice?.logo?.url) {\n      reactiveFooter({ ...slice.footer });\n      logoVar({ url: slice.logo.url });\n    }\n  }, [didMount, slice?.footer, slice?.logo?.url]);\n\n  if (\n    (staticLoading && !data) ||\n    (staticLoading && !staticInstance?.instance)\n  ) {\n    return <GenericLoadingScreen />;\n  }\n\n  if (staticError && !staticLoading) {\n    return <ErrorPage errorType={ErrorPageType.TECHNICAL_ERROR} />;\n  }\n\n  const pageSlices = [...(slice?.staticPages || [])];\n\n  const paramsWithoutSearch = params?.details\n    ? params?.details.toString().replace(window.location.search, '')\n    : null;\n\n  const matchByType = type => type.type === route.name;\n  const matchByParams = slice => slice.routeContext === paramsWithoutSearch;\n\n  const reducePageSlicesToMatchRoute: ({\n    __typename: 'StaticPage';\n  } & Pick<StaticPage, 'name' | 'type'> & {\n      entryId: string;\n      routeContext: Maybe<string> | undefined;\n    })[] = params?.details\n    ? pageSlices.filter(matchByParams)\n    : pageSlices.filter(matchByType);\n\n  const pageEntryId = reducePageSlicesToMatchRoute[0];\n\n  if (!pageEntryId?.entryId && !staticLoading && staticInstance) {\n    return <ErrorPage errorType={ErrorPageType.NOT_FOUND} />;\n  }\n\n  return (\n    <LandingPageWrapper\n      pageTheme=\"Filtered\"\n      landingPageId={pageEntryId?.entryId}\n      {...reducePageSlicesToMatchRoute}\n      {...props}\n    />\n  );\n};\n\n// We need to export default here as it throws an error with the lazy loading\nexport default StaticInstanceParent;\n"],"file":"StaticInstanceParent.js"}